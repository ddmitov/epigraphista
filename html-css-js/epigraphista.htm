<!DOCTYPE html>
<html lang="bg">

	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta charset="utf-8">

		<title>Epigraphista</title>

		<script type="text/javascript" src="chetc/lib/prototype.js"></script>
		<script type="text/javascript" src="chetc/lib/MochiKit/MochiKit.js"></script>
		<script type="text/javascript" src="chetc/lib/chetc.js"></script>

		<script type="text/javascript" src="jquery/jquery-1-11-1-min.js"></script>
		<script type="text/javascript" src="jquery/jquery-textarea-auto-resize.js"></script>

		<script type="text/javascript" src="typegreek.js"></script>

		<link rel="stylesheet" type="text/css" href="bootstrap/css/bootstrap.css" media="all"/>
		<script type="text/javascript" src="bootstrap/js/bootstrap-min.js"></script>
		<link rel="stylesheet" type="text/css" href="bootstrap/css/current.css" media="all"/>

		<style type='text/css'>
			fieldset {
				border: 2px solid green;
				border-radius: 5px;
				padding: 10px;
			}
			legend {
				border: 2px solid green;
				border-radius: 5px;
				margin-top: 0px;
				margin-bottom: 0px;
				padding: 2px 2px;
				font-size: 13px;
				text-align: left;
			}
			pre {
				margin-bottom: 0px;
			}
			.greek {
				font-family: "FreeSans", "Liberation Sans", "Gentium", "New Athena Unicode", "Palatino Linotype", "Arial Unicode MS";
			}
			.greek-text {
				font-size: 18px;
			}
			.greek-help {
				font-size: 24px;
			}
			.xml {
				text-align: left;
			}
			.btn {
				margin-top: 2px;
				margin-bottom: 2px;
			}
			.input-group-addon {
				border: 0px solid transparent;
			}
			.btn-letters {
				font-size: 18px;
			}
		</style>

		<script type="text/javascript">
			// Necessary to avoid conflicts between jQuery and Prototype.js:
			var $jQuery = jQuery.noConflict();

			// Dynamic HTML code:
			function newFileSelected() {
				document.getElementById("NewFileSelection").innerHTML = "Избери друго име на файл";
			}

			function addGreekKeyboardHelp(partialDivName) {
				var greekKeyboardHelpContents = "" +
					"&nbsp;&nbsp;Q&nbsp;<span class='glyphicon glyphicon-arrow-right'></span>&nbsp;Θ&nbsp;&nbsp;" +
					"&nbsp;&nbsp;W&nbsp;<span class='glyphicon glyphicon-arrow-right'></span>&nbsp;Ω&nbsp;&nbsp;" +
					"&nbsp;&nbsp;E&nbsp;<span class='glyphicon glyphicon-arrow-right'></span>&nbsp;Ε&nbsp;&nbsp;" +
					"&nbsp;&nbsp;R&nbsp;<span class='glyphicon glyphicon-arrow-right'></span>&nbsp;Ρ&nbsp;&nbsp;" +
					"&nbsp;&nbsp;T&nbsp;<span class='glyphicon glyphicon-arrow-right'></span>&nbsp;Τ&nbsp;&nbsp;" +
					"&nbsp;&nbsp;Y&nbsp;<span class='glyphicon glyphicon-arrow-right'></span>&nbsp;Ψ&nbsp;&nbsp;" +
					"&nbsp;&nbsp;U&nbsp;<span class='glyphicon glyphicon-arrow-right'></span>&nbsp;Υ&nbsp;&nbsp;" +
					"&nbsp;&nbsp;I&nbsp;<span class='glyphicon glyphicon-arrow-right'></span>&nbsp;Ι&nbsp;&nbsp;" +
					"&nbsp;&nbsp;O&nbsp;<span class='glyphicon glyphicon-arrow-right'></span>&nbsp;Ο&nbsp;&nbsp;" +
					"&nbsp;&nbsp;P&nbsp;<span class='glyphicon glyphicon-arrow-right'></span>&nbsp;Π&nbsp;&nbsp;" +
					"<br>" +
					"&nbsp;&nbsp;A&nbsp;<span class='glyphicon glyphicon-arrow-right'></span>&nbsp;Α&nbsp;&nbsp;" +
					"&nbsp;&nbsp;S&nbsp;<span class='glyphicon glyphicon-arrow-right'></span>&nbsp;Σ&nbsp;&nbsp;" +
					"&nbsp;&nbsp;D&nbsp;<span class='glyphicon glyphicon-arrow-right'></span>&nbsp;Δ&nbsp;&nbsp;" +
					"&nbsp;&nbsp;F&nbsp;<span class='glyphicon glyphicon-arrow-right'></span>&nbsp;Φ&nbsp;&nbsp;" +
					"&nbsp;&nbsp;G&nbsp;<span class='glyphicon glyphicon-arrow-right'></span>&nbsp;Γ&nbsp;&nbsp;" +
					"&nbsp;&nbsp;H&nbsp;<span class='glyphicon glyphicon-arrow-right'></span>&nbsp;Η&nbsp;&nbsp;" +
					"&nbsp;&nbsp;J&nbsp;<span class='glyphicon glyphicon-arrow-right'></span>&nbsp;Σ&nbsp;&nbsp;" +
					"&nbsp;&nbsp;K&nbsp;<span class='glyphicon glyphicon-arrow-right'></span>&nbsp;Κ&nbsp;&nbsp;" +
					"&nbsp;&nbsp;L&nbsp;<span class='glyphicon glyphicon-arrow-right'></span>&nbsp;Λ&nbsp;&nbsp;" +
					"&nbsp;&nbsp;;&nbsp;<span class='glyphicon glyphicon-arrow-right'></span>&nbsp;·&nbsp;&nbsp;" +
					"<br>" +
					"&nbsp;&nbsp;Z&nbsp;<span class='glyphicon glyphicon-arrow-right'></span>&nbsp;Ζ&nbsp;&nbsp;" +
					"&nbsp;&nbsp;X&nbsp;<span class='glyphicon glyphicon-arrow-right'></span>&nbsp;Χ&nbsp;&nbsp;" +
					"&nbsp;&nbsp;C&nbsp;<span class='glyphicon glyphicon-arrow-right'></span>&nbsp;Ξ&nbsp;&nbsp;" +
					"&nbsp;&nbsp;V&nbsp;<span class='glyphicon glyphicon-arrow-right'></span>&nbsp;Ϝ&nbsp;&nbsp;" +
					"&nbsp;&nbsp;B&nbsp;<span class='glyphicon glyphicon-arrow-right'></span>&nbsp;Β&nbsp;&nbsp;" +
					"&nbsp;&nbsp;N&nbsp;<span class='glyphicon glyphicon-arrow-right'></span>&nbsp;Ν&nbsp;&nbsp;" +
					"&nbsp;&nbsp;M&nbsp;<span class='glyphicon glyphicon-arrow-right'></span>&nbsp;Μ&nbsp;&nbsp;" +
					"<br>" +
					"&nbsp;&nbsp;a&nbsp;<span class='glyphicon glyphicon-plus'></span>&nbsp;/&nbsp;<span class='glyphicon glyphicon-arrow-right'></span>&nbsp;ά&nbsp;&nbsp;" +
					"&nbsp;&nbsp;a&nbsp;<span class='glyphicon glyphicon-plus'></span>&nbsp;\\&nbsp;<span class='glyphicon glyphicon-arrow-right'></span>&nbsp;ὰ&nbsp;&nbsp;" +
					"&nbsp;&nbsp;a&nbsp;<span class='glyphicon glyphicon-plus'></span>&nbsp;=&nbsp;<span class='glyphicon glyphicon-arrow-right'></span>&nbsp;ᾶ&nbsp;&nbsp;" +
					"&nbsp;&nbsp;a&nbsp;<span class='glyphicon glyphicon-plus'></span>&nbsp;)&nbsp;<span class='glyphicon glyphicon-arrow-right'></span>&nbsp;ἀ&nbsp;&nbsp;" +
					"&nbsp;&nbsp;a&nbsp;<span class='glyphicon glyphicon-plus'></span>&nbsp;(&nbsp;<span class='glyphicon glyphicon-arrow-right'></span>&nbsp;ἁ&nbsp;&nbsp;" +
					"&nbsp;&nbsp;a&nbsp;<span class='glyphicon glyphicon-plus'></span>&nbsp;|&nbsp;<span class='glyphicon glyphicon-arrow-right'></span>&nbsp;ᾳ&nbsp;&nbsp;" +
					"&nbsp;&nbsp;i&nbsp;<span class='glyphicon glyphicon-plus'></span>&nbsp;+&nbsp;<span class='glyphicon glyphicon-arrow-right'></span>&nbsp;ϊ&nbsp;&nbsp;" +
					"<br>";

				var placeholderElement = document.getElementById(partialDivName + "-greek-keyboard-help");
				var checkboxElement = document.getElementById(partialDivName + "-switch-greek");

				if (placeholderElement.innerHTML.length == 0) {
					placeholderElement.innerHTML = greekKeyboardHelpContents;
					placeholderElement.style.marginBottom = "10px";
					checkboxElement.checked = true;
				} else {
					placeholderElement.innerHTML = "";
					placeholderElement.style.marginBottom = "0px";
				}
			}

			function addAdditionalKeyboard(elementId) {
				var additionalKeyboardFirstRowContents = "" +
					"<input type='button' value='ϐ' onClick=\"javascript:insertTags('ϐ', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='ϲ' onClick=\"javascript:insertTags('ϲ', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='Ϛ' onClick=\"javascript:insertTags('Ϛ', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='ϛ' onClick=\"javascript:insertTags('ϛ', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='Ϟ' onClick=\"javascript:insertTags('Ϟ', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='ϟ' onClick=\"javascript:insertTags('ϟ', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='Ϡ' onClick=\"javascript:insertTags('Ϡ', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='ϡ' onClick=\"javascript:insertTags('ϡ', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"&nbsp;&nbsp;&nbsp;" +
					"<input type='button' value='Ё' onClick=\"javascript:insertTags('Ё', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='ё' onClick=\"javascript:insertTags('ё', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='Ы' onClick=\"javascript:insertTags('Ы', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='ы' onClick=\"javascript:insertTags('ы', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='Э' onClick=\"javascript:insertTags('Э', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='э' onClick=\"javascript:insertTags('э', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='ѝ' onClick=\"javascript:insertTags('ѝ', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"&nbsp;&nbsp;&nbsp;" +
					"<input type='button' value='Ä' onClick=\"javascript:insertTags('Ä', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='ä' onClick=\"javascript:insertTags('ä', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='Ö' onClick=\"javascript:insertTags('Ö', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='ö' onClick=\"javascript:insertTags('ö', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='Ü' onClick=\"javascript:insertTags('Ü', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='ü' onClick=\"javascript:insertTags('ü', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='ß' onClick=\"javascript:insertTags('ß', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;";

				var firstRowBox = document.createElement("div");
				firstRowBox.setAttribute("class", "form-group col-xs-12");
				firstRowBox.innerHTML = additionalKeyboardFirstRowContents;

				var firstRow = document.createElement("div");
				firstRow.setAttribute("class", "row");
				firstRow.appendChild(firstRowBox);

				var additionalKeyboardSecondRowContents = "" +
					"<input type='button' value='É' onClick=\"javascript:insertTags('É', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='é' onClick=\"javascript:insertTags('é', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='À' onClick=\"javascript:insertTags('À', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='à' onClick=\"javascript:insertTags('à', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='È' onClick=\"javascript:insertTags('È', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='è' onClick=\"javascript:insertTags('è', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='Ù' onClick=\"javascript:insertTags('Ù', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='ù' onClick=\"javascript:insertTags('ù', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='Â' onClick=\"javascript:insertTags('Â', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='â' onClick=\"javascript:insertTags('â', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='Ê' onClick=\"javascript:insertTags('Ê', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='ê' onClick=\"javascript:insertTags('ê', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='Î' onClick=\"javascript:insertTags('Î', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='î' onClick=\"javascript:insertTags('î', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='Ô' onClick=\"javascript:insertTags('Ô', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='ô' onClick=\"javascript:insertTags('ô', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='Û' onClick=\"javascript:insertTags('Û', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='û' onClick=\"javascript:insertTags('û', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='Ë' onClick=\"javascript:insertTags('Ë', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='ë' onClick=\"javascript:insertTags('ë', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='Ï' onClick=\"javascript:insertTags('Ï', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='ï' onClick=\"javascript:insertTags('ï', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='Ü' onClick=\"javascript:insertTags('Ü', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='ü' onClick=\"javascript:insertTags('ü', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='Ÿ' onClick=\"javascript:insertTags('Ÿ', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='ÿ' onClick=\"javascript:insertTags('ÿ', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='Ç' onClick=\"javascript:insertTags('Ç', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;" +
					"<input type='button' value='ç' onClick=\"javascript:insertTags('ç', '', '')\" class='btn btn-info btn-xs btn-letters'>&nbsp;";

				var secondRowBox = document.createElement("div");
				secondRowBox.setAttribute("class", "form-group col-xs-12");
				secondRowBox.innerHTML = additionalKeyboardSecondRowContents;

				var secondRow = document.createElement("div");
				secondRow.setAttribute("class", "row");
				secondRow.appendChild(secondRowBox);

				var placeholderElement = document.getElementById(elementId);

				if (!placeholderElement.hasChildNodes()) {
					placeholderElement.appendChild(firstRow);
					placeholderElement.appendChild(secondRow);
				} else {
					while (placeholderElement.hasChildNodes()) {
						placeholderElement.removeChild(placeholderElement.firstChild);
					}
				}
			}

			function addTextAreaElement(label){
				var name = label.replace(/-/g, "_");

				var placeholder;
				if (label == "orig-place") {
					placeholder = "Място на намиране";
				}
				if (label == "orig-date") {
					placeholder = "Време на намиране";
				}
				if (label == "description") {
					placeholder = "Описание на паметника";
				}
				if (label == "layout") {
					placeholder = "Описание на текстовото поле";
				}
				if (label == "hand-note") {
					placeholder = "Описание на шрифта";
				}
				if (label == "apparatus-criticus") {
					placeholder = "Критичен апарат";
				}
				if (label == "translation") {
					placeholder = "Превод";
				}
				if (label == "commentary") {
					placeholder = "Коментар";
				}
				if (label == "bibliography") {
					placeholder = "Библиография";
				}

				var textElementContents = "" +
					"<textarea rows='1' id='" + label + "' name='" + name + "' class='form-control greek greek-text' spellcheck='false'" +
						"title='" + placeholder + "' placeholder='" + placeholder + "'" +
						"onkeypress=\"return convertCharToggle(this, document.main_form." + name + "_switch_greek.checked, event);\"" +
						"onkeyup=\"return convertStr(this, event);\"" +
						"onfocus=\"setCurrentTextArea('" + label + "')\"></textarea>" +
					"<span class='input-group-addon'>" +
						"<input type='checkbox' id='" + label + "-switch-greek' name='" + name + "_switch_greek'" +
						"onclick=\"switchGreek('" + label + "');\" title='Въвеждане на политоничен гръцки текст'/>&nbsp;" +
						"<a href=\"javascript:addGreekKeyboardHelp('" + label + "');\"" +
							"title='Помощ за въвеждането на политоничен гръцки текст'>Ἐλληνική</a>" +
					"</span>" +
					"<span class='input-group-addon btn btn-info'" +
						"onclick=\"javascript:addAdditionalKeyboard('" + label + "-additional-keyboard')\" title='Допълнителна клавиатура'>" +
						"<span class='glyphicon glyphicon-font'></span>" +
					"</span>" +
					"<span class='input-group-addon btn btn-danger' onclick=\"clearTextElementGroup('" + label + "');\" title='Премахване на елемента'>" +
						"<span class='glyphicon glyphicon-remove'></span>" +
					"</span>";

				var textElementInputGroup = document.createElement("div");
				textElementInputGroup.setAttribute("class", "input-group");
				textElementInputGroup.innerHTML = textElementContents;

				var textElementBox = document.createElement("div");
				textElementBox.setAttribute("class", "form-group col-xs-12");
				textElementBox.appendChild(textElementInputGroup);

				var textElementRow = document.createElement("div");
				textElementRow.setAttribute("class", "row");
				textElementRow.appendChild(textElementBox);

				var placeholderElement = document.getElementById(label + "-group");
				placeholderElement.appendChild(textElementRow);

				var textElementGreekKeyboardHelpPlaceholder = document.createElement("div");
				textElementGreekKeyboardHelpPlaceholder.setAttribute("id", label + "-greek-keyboard-help");
				textElementGreekKeyboardHelpPlaceholder.setAttribute("class", "greek greek-help");
				placeholderElement.appendChild(textElementGreekKeyboardHelpPlaceholder);

				var textElementAdditionalKeyboardPlaceholder = document.createElement("div");
				textElementAdditionalKeyboardPlaceholder.setAttribute("id", label + "-additional-keyboard");
				placeholderElement.appendChild(textElementAdditionalKeyboardPlaceholder);

				$jQuery("#" + label).autoResize();

				var buttonToDisable = document.getElementById(label + "-button");
				buttonToDisable.setAttribute("class", "btn btn-info btn-xs disabled");
			}

			function clearTextElementGroup(partialDivName){
				if (confirm("Ако в този елемент е попълнен текст, той ще бъде изтрит!\n" +
					"Въведената информация не може да бъде възстановена!\n" +
					"Сигурни ли сте, че искате да премахнете избрания елемент?")) {
					var placeholderElement = document.getElementById(partialDivName + "-group");
					while (placeholderElement.hasChildNodes()) {
						placeholderElement.removeChild(placeholderElement.firstChild);
					}
					var buttonToEnable = document.getElementById(partialDivName + "-button");
					buttonToEnable.setAttribute("class", "btn btn-info btn-xs");
				}
				return false;
			}

			function resetAlert(){
				if (confirm("Сигурни ли сте, че искате да изтриете\n" +
						"попълнения текст във ВСИЧКИ полета?\n" +
						"Въведената информация не може да бъде възстановена!")) {
					return true;
				}
				return false;
			}

			// TypeGreek code:
			function switchGreek(textAreaId) {
				document.getElementById(textAreaId).focus();
			}

			// Additional keyboard code:
			// The following code is adapted from Steev's JavaScript keyboard (GPL).
			// http://www.bluedust.com/pub/web/sjk.htm
			var currentTextArea;
			function setCurrentTextArea(textAreaId) {
				currentTextArea = document.getElementById(textAreaId);
			}
			// The following code is adapted from wikibits.js - MediaWiki JavaScript support functions and phpBB (both GPL).
			// http://www.mediawiki.org/wiki/MediaWiki
			// http://www.phpbb.com/support/license.php
			var clientBrowser = navigator.userAgent.toLowerCase();
			// Get client info:
			var is_gecko = ((clientBrowser.indexOf('gecko')!=-1) && (clientBrowser.indexOf('khtml') == -1));
			function insertTags(tagOpen, tagClose, sampleText) {
				// IE:
				if (document.selection && !is_gecko) {
					var theSelection = document.selection.createRange().text;
					if (!theSelection)
						theSelection=sampleText;
					currentTextArea.focus();
					// Exclude ending space char, if any:
					if (theSelection.charAt(theSelection.length - 1) == " ") {
						theSelection = theSelection.substring(0, theSelection.length - 1);
						document.selection.createRange().text = tagOpen + theSelection + tagClose + " ";
					} else {
						document.selection.createRange().text = tagOpen + theSelection + tagClose;
					}
				// Mozilla:
				} else if(currentTextArea.selectionStart || currentTextArea.selectionStart == '0') {
					var replaced = false;
					var startPos = currentTextArea.selectionStart;
					var endPos = currentTextArea.selectionEnd;
					if (endPos-startPos)
						replaced = true;
					var scrollTop = currentTextArea.scrollTop;
					var myText = (currentTextArea.value).substring(startPos, endPos);
					if (!myText)
						myText=sampleText;
					// Exclude ending space char, if any:
					if (myText.charAt(myText.length - 1) == " ") {
						subst = tagOpen + myText.substring(0, (myText.length - 1)) + tagClose + " ";
					} else {
						subst = tagOpen + myText + tagClose;
					}
					currentTextArea.value = currentTextArea.value.substring(0, startPos) + subst +
						currentTextArea.value.substring(endPos, currentTextArea.value.length);
					currentTextArea.focus();
					// Set new selection:
					if (replaced) {
						var cPos = startPos+(tagOpen.length+myText.length+tagClose.length);
						currentTextArea.selectionStart = cPos;
						currentTextArea.selectionEnd = cPos;
					} else {
						currentTextArea.selectionStart = startPos+tagOpen.length;
						currentTextArea.selectionEnd = startPos+tagOpen.length+myText.length;
					}
					currentTextArea.scrollTop = scrollTop;
				}
				// Reposition cursor, if possible:
				if (currentTextArea.createTextRange)
					currentTextArea.caretPos = document.selection.createRange().duplicate();
			}

			// Chapel Hill Epigraphic Text Converter modified code:
			var xml = null;
			var result = null;

			function startEpigraphicConverter() {
				request = doSimpleXMLHttpRequest("chetc/replacements.txt");
				request.addCallback(convertEpigraphicDocument);
			}

			function convertEpigraphicDocument(xmlHttpRequest) {
				var epigraphicConverter = new Epigraph2Markup(xmlHttpRequest.responseText);
				epigraphicConverter.lineBreaks("false");
				result = epigraphicConverter.convert(strip($('original-text').value));

				var xmlLines = result.split('lineNumber');
				for (var lineNumber = 1; lineNumber < xmlLines.length; lineNumber++) {
					result = result.replace(/lineNumber/, lineNumber + 1);
				}
				xml = "<lb n=\"1\"/> " + result;

				var resultHTML = escapeHTML("<ab><lb n=\"1\"/> " + result);
				resultHTML = resultHTML.replace(/(&lt;lb[^\/]*\/&gt;)/g, "<br>$1");
				resultHTML = resultHTML + "<br>&lt;/ab&gt;"
				var lines = resultHTML.split('lineNumber');
				for (var lineNumber = 1; lineNumber < lines.length; lineNumber++) {
					resultHTML = resultHTML.replace(/lineNumber/, lineNumber + 1);
				}

				document.getElementById("original-text-html").innerHTML = resultHTML;
				document.getElementById("original-text-xml").setAttribute("value", xml);
				$jQuery("#original-text-formatted").show();
			}

			function finalCheckAndSubmit() {
				var originalText = document.getElementById("original-text").value;
				if (originalText.length < 3) {
					alert("Моля, попълнете оригиналния текст на надписа!");
					return false;
				}

				document.forms["main_form"].submit();
			}
		</script>
	</head>

	<body>
		<div class="container-fluid">

			<form name="main_form" action="http://perl-executing-browser-pseudodomain/perl/epigraphista.pl" method="post" target="iframe_a">

				<!-- Description Elements -->
				<fieldset>
						<legend>
							<div id="description-buttons-group">
								&nbsp;
								Описание на надписа
								&nbsp;
								<input type="button" id="description-button" value="Описание на паметника"
									onClick="javascript:addTextAreaElement('description');" class="btn btn-info btn-xs">

								<input type="button" id="layout-button" value="Описание на текстовото поле"
									onClick="javascript:addTextAreaElement('layout');" class="btn btn-info btn-xs">

								<input type="button" id="hand-note-button" value="Описание на шрифта"
									onClick="javascript:addTextAreaElement('hand-note');" class="btn btn-info btn-xs">

								<input type="button" id="orig-place-button" value="Място на намиране"
									onClick="javascript:addTextAreaElement('orig-place');" class="btn btn-info btn-xs">

								<input type="button" id="orig-date-button" value="Време на намиране"
									onClick="javascript:addTextAreaElement('orig-date');" class="btn btn-info btn-xs">
							</div>
						</legend>

					<div class="row">
						<div class="form-group col-xs-4 col-xs-offset-4">
							<div class="input-prepend">
								<textarea rows="1" id="title" name="title" class="form-control greek-text" spellcheck="false" placeholder="Заглавие"></textarea>
							</div>
						</div>
					</div>

					<div class="row">
						<div class="form-group col-xs-4 col-xs-offset-4">
							<div class="input-prepend">
								<textarea rows="1" id="repository" name="repository" class="form-control greek-text" spellcheck="false" placeholder="Музей"></textarea>
							</div>
						</div>
					</div>

					<div class="row">
						<div class="form-group col-xs-2 col-xs-offset-5">
							<div class="input-prepend">
								<textarea rows="1" id="idno" name="idno" class="form-control greek-text" spellcheck="false" placeholder="Инвентарен номер"></textarea>
							</div>
						</div>
					</div>

					<div id="description-group">
					</div>

					<div id="layout-group">
					</div>

					<div id="hand-note-group">
					</div>

					<div id="orig-place-group">
					</div>

					<div id="orig-date-group">
					</div>
				</fieldset>

				<br>

				<!-- Text Elements -->
				<fieldset>
					<legend>
						<div id="text-buttons-group">
							&nbsp;
							Текст на надписа
							&nbsp;
							<input type="button" id="apparatus-criticus-button" value="Критичен апарат"
								onClick="javascript:addTextAreaElement('apparatus-criticus');" class="btn btn-info btn-xs">

							<input type="button" id="translation-button" value="Превод"
								onClick="javascript:addTextAreaElement('translation');" class="btn btn-info btn-xs">

							<input type="button" id="commentary-button" value="Коментар"
								onClick="javascript:addTextAreaElement('commentary');" class="btn btn-info btn-xs">

							<input type="button" id="bibliography-button" value="Библиография"
								onClick="javascript:addTextAreaElement('bibliography');" class="btn btn-info btn-xs">
						</div>
					</legend>

					<div id="original-text-group">
						<div class="row">
							<div class="form-group col-xs-12">
								<div class="input-group">
									<textarea rows="1" id="original-text" class="form-control greek greek-text" spellcheck="false"
										 title="Оригинален текст" placeholder="Оригинален текст"
										onkeypress="javascript:return convertCharToggle(this, document.main_form.original_text_switch_greek.checked, event);"
										onkeyup="javascript:return convertStr(this, event);"
										onfocus="javascript:setCurrentTextArea('original-text')" oninput="javascript:startEpigraphicConverter();"></textarea>
									<span class="input-group-addon btn btn-info"
										onclick="javascript:startEpigraphicConverter();" title="Превръщане на оригиналния текст в Epidoc XML фрагмент">
										<b>XML</b>
									</span>
									<span class="input-group-addon">
										<input type="checkbox" id="original-text-switch-greek" name="original_text_switch_greek"
											onclick="switchGreek('original-text');" title="Въвеждане на политоничен гръцки текст"/>&nbsp;
										<a href="javascript:addGreekKeyboardHelp('original-text');"
											title="Помощ за въвеждането на политоничен гръцки текст">Ἐλληνική</a>
									</span>
									<span class="input-group-addon btn btn-info"
										onclick="javascript:addAdditionalKeyboard('original-text-additional-keyboard')" title="Допълнителна клавиатура">
										<span class="glyphicon glyphicon-font"></span>
									</span>
								</div>
							</div>
						</div>

						<div id="original-text-greek-keyboard-help" class="greek greek-help"></div>

						<div id="original-text-additional-keyboard"></div>

						<div id="original-text-formatted">
							<div class="row">
								<div class="form-group col-xs-12">
									<pre id="original-text-html" title="Epidoc XML фрагмент с оригиналния текст" class="greek greek-text xml"></pre>
								</div>
							</div>
							<input type="hidden" id="original-text-xml" name="original_text_xml" value="">
						</div>
					</div>

					<div id="apparatus-criticus-group"></div>

					<div id="translation-group"></div>

					<div id="commentary-group"></div>

					<div id="bibliography-group"></div>
				</fieldset>

				<!-- Submitt & Reset Buttons -->
				<br>
				<input type="reset" value="Изтрий всички полета!" onclick='return resetAlert();' class="btn btn-danger">
				<br><br>
				<input type="button" value="Запиши" onClick="javascript:finalCheckAndSubmit();" class="btn btn-primary">
				<br><br>
			</form>

			<script type="text/javascript">
				$jQuery(document).ready(function() {
					$jQuery("#title").autoResize();
					$jQuery("#repository").autoResize();
					$jQuery("#idno").autoResize();
					$jQuery("#original-text").autoResize();
				});

				$jQuery("#original-text-formatted").hide();
			</script>

		</div>
	</body>

</html>
